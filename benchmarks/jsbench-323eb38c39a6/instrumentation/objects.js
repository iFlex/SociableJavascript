/*
 * Copyright (C) 2010-2012 Purdue University
 * Written by Gregor Richards
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 * 
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */

(function() {
    // we keep a master list of objects that should and should not be instrumented
    JSBNG.Objects = {
        doInstrument: {
            // These are from ECMAScript:
            // .4
            Date:true,


            // Found in browsers:
            "document":true, "sessionStorage":true, "globalStorage":true,
            "localStorage":true, "getComputedStyle":true, "dispatchEvent":true,
            "removeEventListener":true, "addEventListener":true, "top":true,
            "getSelection":true, "scrollByLines":true, "dump":true,
            "scrollbars":true, "scrollX":true, "scrollY":true, "scrollTo":true,
            "scrollBy":true, "scrollByPages":true, "sizeToContent":true,
            "setTimeout":true, "setInterval":true, "clearTimeout":true,
            "clearInterval":true, "setResizable":true, "captureEvents":true,
            "releaseEvents":true, "routeEvent":true,
            "enableExternalCapture":true, "disableExternalCapture":true,
            "openDialog":true, "frames":true, "applicationCache":true,
            "self":true, "navigator":true, "screen":true, "history":true,
            "content":true, "menubar":true, "toolbar":true, "locationbar":true,
            "personalbar":true, "statusbar":true, "closed":true, "crypto":true,
            "pkcs11":true, "controllers":true, "opener":true,
            "defaultStatus":true, "location":true, "innerWidth":true,
            "innerHeight":true, "outerWidth":true, "outerHeight":true,
            "screenX":true, "screenY":true, "mozInnerScreenX":true,
            "mozInnerScreenY":true, "pageXOffset":true, "pageYOffset":true,
            "scrollMaxX":true, "scrollMaxY":true, "fullScreen":true,
            "alert":true, "confirm":true, "prompt":true, "back":true,
            "forward":true, "home":true, "stop":true, "print":true,
            "moveTo":true, "moveBy":true, "resizeTo":true, "resizeBy":true,
            "scroll":true, "updateCommands":true, "atob":true, "btoa":true,
            "frameElement":true, "showModalDialog":true, "postMessage":true,
            "mozPaintCount":true, "mozRequestAnimationFrame":true,
            "mozAnimationStartTime":true, "mozIndexedDB":true, "netscape":true,
            "directories":true, "webkitAudioContext":true,
            "webkitAudioPannerNode":true, "webkitStorageInfo":true,
            "webkitRequestFileSystem":true,
            "webkitResolveLocalFileSystemURL":true,
            "external":true, "v8Locale":true, "webkitIDBTransaction":true,
            "webkitNotifications":true, "webkitIDBIndex":true,
            "webkitIDBDatabaseError":true, "webkitIndexedDB":true,
            "screenLeft":true, "webkitIDBDatabaseException":true,
            "webkitIDBFactory":true, "clientInformation":true,
            "webkitIDBCursor":true, "defaultstatus":true, "styleMedia":true,
            "performance":true, "webkitIDBDatabase":true, "console":true,
            "webkitIDBRequest":true, "webkitIDBObjectStore":true, "event":true,
            "devicePixelRatio":true, "webkitURL":true,
            "webkitIDBKeyRange":true, "offscreenBuffering":true,
            "screenTop":true, "matchMedia":true,
            "webkitRequestAnimationFrame":true,
            "webkitCancelRequestAnimationFrame":true,
            "getMatchedCSSRules":true, "webkitConvertPointFromPageToNode":true,
            "webkitConvertPointFromNodeToPage":true, "openDatabase":true,
            "requestFileSystem":true, "resolveLocalFileSystemURI":true,
            "XMLHttpRequest":true, "Image":true, "webkitIDBEvent":true,
            "webkitIDBSuccessEvent":true, "webkitIDBErrorEvent":true,
            "webkitPerformance":true, "revokeObjectURL":true,
            "createObjectURL":true, "revokeBlobURL":true, "createBlobURL":true,
            "chromium":true, "maxConnectionsPerServer":true,
            "clipboardData":true, "searchsuggest":true, "attachevent":true,
            "detachevent":true, "navigate":true, "opera":true,
            "searchSuggest":true, "attachEvent":true, "detachEvent":true,
            "addEventStream":true, "removeEventStream":true,
            "InstallTrigger":true, "URL":true, "name":true, "focus":true,
            "blur":true, "find":true, "status":true,
            "XPCSafeJSObjectWrapper":true, "XPCNativeWrapper":true,
            "Components":true, "Float64Array":true, "SVGMPathElement":true,
            "SVGGlyphRefElement":true, "SVGAltGlyphDefElement":true,
            "CloseEvent":true, "SVGAnimateMotionElement":true,
            "SVGAltGlyphItemElement":true, "WebKitFlags":true,
            "SVGFEDropShadowElement":true, "WebKitBlobBuilder":true,
            "SVGPathSegLinetoVerticalRel":true, "SVGFESpotLightElement":true,
            "HTMLButtonElement":true, "Worker":true, "EntityReference":true,
            "NodeList":true, "SVGAnimatedNumber":true, "SVGTSpanElement":true,
            "MimeTypeArray":true, "SVGPoint":true, "SVGScriptElement":true,
            "OverflowEvent":true, "HTMLTableColElement":true,
            "HTMLOptionElement":true, "HTMLInputElement":true,
            "SVGFEPointLightElement":true, "SVGPathSegList":true,
            "SVGImageElement":true, "MutationEvent":true,
            "SVGMarkerElement":true, "HTMLMetaElement":true,
            "WebKitCSSTransformValue":true, "Clipboard":true,
            "HTMLTableElement":true, "SharedWorker":true, "SVGAElement":true,
            "SVGAnimatedRect":true, "SVGGElement":true,
            "SVGLinearGradientElement":true, "SVGForeignObjectElement":true,
            "SVGAnimateElement":true, "SVGFontElement":true,
            "SVGFontFaceElement":true, "Element":true,
            "SVGPathSegCurvetoQuadraticSmoothRel":true, "SVGStopElement":true,
            "Flags":true, "CSSStyleSheet":true, "StyleSheetList":true,
            "WebGLShader":true, "Uint32Array":true, "TimeRanges":true,
            "HTMLHRElement":true, "SVGViewElement":true,
            "SVGGradientElement":true, "SVGPathSegMovetoRel":true,
            "CanvasPattern":true, "WebGLActiveInfo":true,
            "HTMLProgressElement":true, "HTMLDivElement":true,
            "HashChangeEvent":true, "KeyboardEvent":true,
            "SVGHKernElement":true, "HTMLTitleElement":true,
            "HTMLQuoteElement":true, "SVGFEImageElement":true,
            "DOMTokenList":true, "WebGLProgram":true,
            "SVGPathSegMovetoAbs":true, "RangeException":true,
            "SVGTextPathElement":true, "SVGAnimatedTransformList":true,
            "HTMLLegendElement":true, "SVGPathSegCurvetoQuadraticAbs":true,
            "MouseEvent":true, "MediaError":true, "Uint16Array":true,
            "HTMLObjectElement":true, "HTMLFontElement":true,
            "SVGFilterElement":true, "WebKitTransitionEvent":true,
            "MediaList":true, "SVGVKernElement":true, "SVGPaint":true,
            "SVGFETileElement":true, "Document":true, "XPathException":true,
            "TextMetrics":true, "HTMLHeadElement":true,
            "SVGFEComponentTransferElement":true, "ProgressEvent":true,
            "SVGAnimatedPreserveAspectRatio":true, "Node":true,
            "SVGRectElement":true, "CSSPageRule":true, "SVGLineElement":true,
            "CharacterData":true, "FileError":true, "SVGDocument":true,
            "MessagePort":true, "ClientRect":true, "Option":true,
            "SVGDescElement":true, "Notation":true, "WebGLBuffer":true,
            "StorageEvent":true, "HTMLFieldSetElement":true,
            "HTMLVideoElement":true, "SVGPathSegLinetoRel":true,
            "WebGLTexture":true, "UIEvent":true, "HTMLTableRowElement":true,
            "HTMLDListElement":true, "File":true, "SVGEllipseElement":true,
            "SVGFEFuncRElement":true, "Int32Array":true,
            "HTMLAllCollection":true, "CSSValue":true,
            "SVGAnimatedNumberList":true, "HTMLParamElement":true,
            "SVGElementInstance":true, "HTMLModElement":true,
            "SVGPathSegLinetoHorizontalRel":true, "CSSFontFaceRule":true,
            "SVGPathSeg":true, "CSSStyleDeclaration":true, "WebSocket":true,
            "TouchEvent":true, "Rect":true, "StyleSheet":true,
            "SVGPathSegLinetoHorizontalAbs":true, "SVGColor":true,
            "ArrayBuffer":true, "SVGComponentTransferFunctionElement":true,
            "SVGStyleElement":true, "Int16Array":true,
            "HTMLOutputElement":true, "SVGNumberList":true, "DataView":true,
            "DeviceOrientationEvent":true, "Blob":true,
            "SVGFEFloodElement":true, "HTMLStyleElement":true,
            "HTMLBaseElement":true, "HTMLBRElement":true, "FileReader":true,
            "SVGFEBlendElement":true, "HTMLHtmlElement":true,
            "SVGFEConvolveMatrixElement":true, "SVGFEGaussianBlurElement":true,
            "HTMLTextAreaElement":true, "HTMLBaseFontElement":true,
            "WebGLRenderbuffer":true, "SVGTextElement":true,
            "SVGFEOffsetElement":true, "RGBColor":true, "SVGGlyphElement":true,
            "Float32Array":true, "HTMLCanvasElement":true,
            "ProcessingInstruction":true, "SVGZoomEvent":true,
            "HTMLFrameElement":true, "SVGElementInstanceList":true,
            "SVGFEDisplacementMapElement":true,
            "SVGPathSegCurvetoCubicSmoothRel":true, "HTMLElement":true,
            "HTMLSelectElement":true, "Int8Array":true,
            "SVGFEDistantLightElement":true, "ImageData":true,
            "SVGFEFuncBElement":true, "HTMLIsIndexElement":true,
            "HTMLDocument":true, "SVGCircleElement":true,
            "HTMLCollection":true, "SVGSetElement":true,
            "SVGFEMergeElement":true, "HTMLDirectoryElement":true,
            "CSSMediaRule":true, "MessageEvent":true,
            "SVGFESpecularLightingElement":true, "DOMException":true,
            "SVGNumber":true, "SVGFontFaceSrcElement":true, "CSSRule":true,
            "SVGElement":true, "WebKitCSSMatrix":true,
            "SVGMissingGlyphElement":true, "HTMLScriptElement":true,
            "DOMImplementation":true, "SVGLength":true,
            "HTMLOptGroupElement":true, "SVGPathSegLinetoVerticalAbs":true,
            "SVGTextPositioningElement":true, "HTMLKeygenElement":true,
            "SVGFEFuncGElement":true, "HTMLAreaElement":true,
            "HTMLFrameSetElement":true, "SVGPathSegCurvetoQuadraticRel":true,
            "HTMLIFrameElement":true, "Comment":true, "Event":true,
            "Storage":true, "XMLSerializer":true, "Range":true,
            "HTMLPreElement":true, "DOMStringList":true,
            "SVGPathSegCurvetoQuadraticSmoothAbs":true, "SVGRect":true,
            "SVGFontFaceFormatElement":true, "SVGAnimateTransformElement":true,
            "HTMLOListElement":true, "HTMLFormElement":true,
            "SVGPathSegClosePath":true, "SVGPathSegCurvetoCubicSmoothAbs":true,
            "SVGPathSegArcRel":true, "EventException":true,
            "SVGAnimatedString":true, "SVGTransformList":true,
            "SVGFEMorphologyElement":true, "SVGAnimatedLength":true,
            "SVGPolygonElement":true, "SVGPathSegLinetoAbs":true,
            "HTMLMediaElement":true, "BlobBuilder":true, "XMLDocument":true,
            "SVGMaskElement":true, "HTMLHeadingElement":true, "TextEvent":true,
            "HTMLMeterElement":true, "SVGPathElement":true,
            "SVGStringList":true, "HTMLAppletElement":true, "FileList":true,
            "CanvasRenderingContext2D":true, "MessageChannel":true,
            "WebGLRenderingContext":true, "HTMLMarqueeElement":true,
            "WebKitCSSKeyframesRule":true, "XSLTProcessor":true,
            "CSSImportRule":true, "BeforeLoadEvent":true,
            "PageTransitionEvent":true, "CSSRuleList":true,
            "SVGAnimatedLengthList":true, "SVGTransform":true,
            "SVGTextContentElement":true, "HTMLTableSectionElement":true,
            "SVGRadialGradientElement":true, "HTMLTableCellElement":true,
            "SVGCursorElement":true, "DocumentFragment":true,
            "SVGPathSegCurvetoCubicAbs":true, "SVGUseElement":true,
            "FormData":true, "SVGPreserveAspectRatio":true,
            "HTMLMapElement":true, "XPathResult":true, "HTMLLIElement":true,
            "SVGSwitchElement":true, "SVGLengthList":true, "Plugin":true,
            "HTMLParagraphElement":true, "HTMLBlockquoteElement":true,
            "SVGPathSegArcAbs":true, "SVGAnimatedBoolean":true,
            "CSSStyleRule":true, "SVGFontFaceUriElement":true, "Text":true,
            "HTMLUListElement":true, "WebGLUniformLocation":true,
            "SVGPointList":true, "CSSPrimitiveValue":true,
            "HTMLEmbedElement":true, "PluginArray":true,
            "SVGPathSegCurvetoCubicRel":true, "ClientRectList":true,
            "SVGMetadataElement":true, "SVGTitleElement":true,
            "SVGAnimatedAngle":true, "CSSCharsetRule":true,
            "SVGAnimateColorElement":true, "SVGMatrix":true,
            "HTMLBodyElement":true, "SVGSymbolElement":true,
            "HTMLAudioElement":true, "CDATASection":true,
            "SVGFEDiffuseLightingElement":true, "SVGFETurbulenceElement":true,
            "SVGAnimatedEnumeration":true, "WebKitCSSKeyframeRule":true,
            "Audio":true, "SVGFEMergeNodeElement":true, "Entity":true,
            "SQLException":true, "HTMLTableCaptionElement":true,
            "DOMStringMap":true, "MimeType":true, "EventSource":true,
            "SVGException":true, "NamedNodeMap":true, "WebGLFramebuffer":true,
            "XMLHttpRequestUpload":true, "WebKitAnimationEvent":true,
            "Uint8Array":true, "SVGAnimatedInteger":true,
            "HTMLMenuElement":true, "SVGDefsElement":true, "SVGAngle":true,
            "SVGSVGElement":true, "XPathEvaluator":true,
            "HTMLImageElement":true, "NodeFilter":true,
            "SVGAltGlyphElement":true, "SVGClipPathElement":true, "Attr":true,
            "Counter":true, "SVGPolylineElement":true,
            "DOMSettableTokenList":true, "SVGPatternElement":true,
            "SVGFECompositeElement":true, "CSSValueList":true,
            "XMLHttpRequestException":true, "SVGFEColorMatrixElement":true,
            "SVGTRefElement":true, "WheelEvent":true, "SVGUnitTypes":true,
            "HTMLLabelElement":true, "HTMLAnchorElement":true,
            "SVGFEFuncAElement":true, "CanvasGradient":true,
            "DocumentType":true, "DOMParser":true, "SVGRenderingIntent":true,
            "WebKitPoint":true, "HTMLLinkElement":true,
            "SVGFontFaceNameElement":true,"TEMPORARY":true, "PERSISTENT":true,
            "CSSVariablesDeclaration":true, "CSSVariablesRule":true,
            "SVGZoomAndPan":true, "OfflineAudioCompletionEvent":true,
            "XMLHttpRequestProgressEvent":true, "HTMLSpanElement":true,
            "ErrorEvent":true, "HTMLUnknownElement":true,
            "MediaStreamEvent":true, "WebGLContextEvent":true,
            "AudioProcessingEvent":true, "CompositionEvent":true,
            "PopStateEvent":true, "CustomEvent":true, "HTMLSourceElement":true,
            "SpeechInputEvent":true, "MediaController":true,
            "webkitPostMessage":true, "WebKitMutationObserver":true,
            "WebKitCSSFilterValue":true, "webkitCancelAnimationFrame":true,
            "mozCancelAnimationFrame":true,
            "mozCancelRequestAnimationFrame":true, "WebKitCSSRegionRule":true,
            "Window":true, "orientation":true, "Selection":true,
            "Uint8ClampedArray":true, "DeviceMotionEvent":true,
            "WebGLShaderPrecisionFormat":true, "Notification":true,
	    "HTMLDataListElement":true, "SVGViewSpec":true, "sidebar":true,
	    "getDefaultComputedStyle":true, "indexedDB":true, "Intl":true,
	    "v8Intl":true, "webkitRTCPeerConnection":true,
            "webkitMediaStream":true, "webkitOfflineAudioContext":true,
            "webkitSpeechGrammarList":true, "webkitSpeechGrammar":true,
            "webkitSpeechRecognitionEvent":true, "webkitSpeechRecognitionError":true,
            "webkitSpeechRecognition":true, "WebKitSourceBufferList":true,
            "WebKitSourceBuffer":true, "WebKitMediaSource":true, "TrackEvent":true,
            "TextTrackList":true, "TextTrackCueList":true, "TextTrackCue":true,
            "TextTrack":true, "HTMLTrackElement":true, "MediaKeyError":true,
            "MediaKeyEvent":true, "HTMLShadowElement":true, "HTMLContentElement":true,
            "WebKitShadowRoot":true, "RTCIceCandidate":true, "RTCSessionDescription":true,
            "IDBVersionChangeEvent":true, "IDBTransaction":true, "IDBRequest":true,
            "IDBOpenDBRequest":true, "IDBObjectStore":true, "IDBKeyRange":true,
            "IDBIndex":true, "IDBFactory":true, "IDBDatabase":true,
            "IDBCursorWithValue":true, "IDBCursor":true, "MutationObserver":true,
            "AutocompleteErrorEvent":true, "TransitionEvent":true, "FocusEvent":true,
            "ArrayBufferView":true, "HTMLOptionsCollection":true,
            "HTMLFormControlsCollection":true, "HTMLTemplateElement":true,
            "CSSHostRule":true, "WebKitCSSMixFunctionValue":true,
            "WebKitCSSFilterRule":true, "requestAnimationFrame":true,
	    "cancelAnimationFrame":true, "getSearchEngine":true,
            "setSearchEngine":true, "supportsCSS":true, "onerror":true,
            "CSS":true,

            /* These aren't real global members, but are so frequently used in
             * reflective access expressions such as ["inner"+x] that it's
             * valuable to instrument them as if they are */
            "inner": true, "outer": true,

            // Firebug
            "_createFirebugConsole":true, "loadFirebugConsole":true,
            "getInterface":true

        },

        // event functions, which require special instrumentation
        onInstrument: {
            "onseeked":true, "onkeypress":true,
            "onmousedown":true, "ondragleave":true, "ondblclick":true,
            "onseeking":true, "onclick":true, "ontimeupdate":true,
            "ondragstart":true, "onmouseup":true, "onmessage":true,
            "onratechange":true, "onended":true, "ondragover":true,
            "ondragenter":true, "onsearch":true, "onpause":true,
            "onmouseout":true, "onsubmit":true, "onoffline":true,
            "onwaiting":true, "onwebkittransitionend":true,
            "oncanplaythrough":true, "onplay":true, "onfocus":true,
            "onbeforeunload":true, "ondrag":true, "onloadstart":true,
            "onvolumechange":true, "onscroll":true, "onloadedmetadata":true,
            "ondragend":true, "onprogress":true, "onforminput":true,
            "onreset":true, "ononline":true, "onpagehide":true,
            "oninvalid":true, "onblur":true, "onstalled":true,
            "ondurationchange":true, "onemptied":true, "onabort":true,
            "onkeyup":true, "onwebkitanimationiteration":true,
            "onwebkitanimationend":true, "onkeydown":true, "onpageshow":true,
            "onstorage":true, "onformchange":true,
            "onloadeddata":true, "onunload":true, "onsuspend":true,
            "onselect":true, "onplaying":true, "ondeviceorientation":true,
            "onpopstate":true, "onhashchange":true, "ondrop":true,
            "onmousemove":true, "oninput":true, "onchange":true,
            "oncontextmenu":true, "onmousewheel":true, "oncanplay":true,
            "onload":true, "onmouseover":true, "onresize":true,
            "onwebkitanimationstart":true, 
            "onbeforeprint":true, "onafterprint":true, "onhelp":true,
            "onSearch":true, "ontouchstart":true, "ontouchend":true,
            "ontouchmove":true, "ontouchcancel":true, "onmouseenter":true,
            "onmouseleave":true, "ondevicemotion":true,
            "onmozfullscreenchange":true, "onmozfullscreenerror":true,
            "onshow":true, "oncopy":true, "oncut":true, "onpaste":true,
            "onbeforescriptexecute":true, "onafterscriptexecute":true,
            "onorientationchange":true, "onmozpointerlockchange":true,
	    "onmozpointerlockerror":true, "ondeviceproximity":true,
	    "onuserproximity":true, "ondevicelight":true, "onwheel":true,
            "ontransitionend":true,

            /* and finally, to catch reflective access */
            "on":true,
        },

        dontInstrument: {
            // These are from ECMAScript:
            // 15.1.1
            NaN:true,
            Infinity:true,
            undefined:true,
    
            // .2
            eval:true,
            parseInt:true,
            parseFloat:true,
            isNaN:true,
            isFinite:true,
    
            // .3
            decodeURI:true,
            encodeURI:true,
    
            // .4
            Object:true,
            Function:true,
            Array:true,
            String:true,
            Boolean:true,
            Number:true,
            RegExp:true,
            Error:true,
            EvalError:true,
            RangeError:true,
            ReferenceError:true,
            SyntaxError:true,
            TypeError:true,
            URIError:true,
    
            // .5
            Math:true,
            JSON:true,
    
    
            // Non-ECMAScript global reference:
            window:true,


            // Found in browsers:
            "close":true, "parent":true, "open":true, "length":true,
        },

        destroy: {
            "chrome":true,
        },
    };
})();
